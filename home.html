<!doctype html>
<html>
<head>
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta charset='utf8'>
    <title>GeekyLog - Dashboard</title>
    <link rel="stylesheet" href="css/materialize.min.css">  
    <link rel="stylesheet" href="css/geeky-log.css">
</head>
  <body>
 
    <nav>
        <div class="nav-wrapper">
          <a id="logo" href="index.html">GeekyLog</a>
          <ul id="nav-mobile" class="right hide-on-med-and-down">
          </ul>
        </div>
    </nav>  
    
      <div class="row">
        
        <div id="loader" class="progress"><div class="indeterminate"></div></div>
        
        <div class="col s4"> 
          <div class="card blue-grey darken-3">
            <div class="card-content white-text ">
              <span class="card-title">Content</span>
              <span class="card-title sub-title">Inventory</span> 
              <p><i>Total URLs</i> <span id='URLsTotal'></span></p>
              <p><i>Total Pages</i> <span id='pagesTotal'></span> </p>
              <p><i>Total CSS</i> <span id='assetsCss'></span></p>
              <p><i>Total JS</i> <span id='assetsJs'></span></p>
              <p><i>Total Images</i> <span id='assetsImages'></span></p>
              <span class="card-title sub-title">Global status</span> 
              <p><i>200</i> <span id='status200'></span></p>
              <p><i>301</i> <span id='status301'></span></p>
              <p><i>302</i> <span id='status302'></span></p>
              <p><i>403</i> <span id='status403'></span></p>
              <p><i>404</i> <span id='status404'></span></p>
              <p><i>410</i> <span id='status410'></span></p>
              <p><i>5xx</i> <span id='status5xx'></span></p>
              
            </div>  
          </div> 
        </div> 
        
        <div class="col s4"> 
          <div class="card blue-grey darken-3">
            <div class="card-content white-text ">
              <span class="card-title">Hits</span>
              <span class="card-title sub-title">General</span> 
              <p><i>Total Hits</i> <span id='hitsTotal'></span> </p>
              <!--<p><i>Pages</i> <span id='hitsTotal'></span> </p>
              <p><i>CSS</i> <span id='hitsTotal'></span> </p>
              <p><i>JS</i> <span id='hitsTotal'></span> </p> 
              <p><i>Images</i> <span id='hitsTotal'></span> </p>-->
              <span class="card-title sub-title">Bots Hits</span> 
              <p><i>All Bots</i> <span id='botsHits'></span> </p>
              <p><i>Google</i> <span id='gBotsHits2'></span> </p>
              <p><i>Bing</i> <span id='bingHits'></span> </p>
              <p><i>Yandex</i> <span id='yandexHits'></span> </p>
              <p><i>Baidu</i> <span id='baiduHits'></span> </p>  
              <span class="card-title sub-title">Googlebots</span>  
              <p><i>All G bots</i> <span id='gBotsHits'></span> </p>
              <p><i>Gbot Search</i> <span id='gSearchHits'></span> </p>
              <p><i>Gbot Img</i> <span id='gImgHits'></span> </p>
              <!--<p><i>G bots errors</i> <span id='gBotsErrors'></span> </p>-->
            </div>  
          </div> 
        </div>
 
        <div class="col s4">   
          <div class="card blue-grey darken-3">
            <div class="card-content white-text "> 
              <span class="card-title">Googlebot Search</span>
              <span class="card-title sub-title">Hits</span>
              <p><i>Hits</i> <span id='gSearchHits2'></span> </p>
              <p><i>Hits/explored</i> <span id='gSearchMedian'></span> </p>
              
              <span class="card-title sub-title">Pages</span>
              <p><i>Total</i> <span id='pagesTotal2'></span> </p>
              <p><i>Explored</i> <span id='pagesExplored'></span> </p>
              <p><i>Unexplored</i> <span id='pagesUnexplored'></span> </p>
              <p><i>Actives</i> <span id='pagesActives'></span> </p>
              <p><i>Inactives</i> <span id='pagesInactives'></span> </p>
               
              <span class="card-title sub-title">IPs</span>
              <p><i>Verified IPs</i> <span id='gSearchIPs'></span> </p>
              <p><i>Fake IPs</i> <span id='fakeGbotIPs'></span> </p>
            </div> 
          </div> 
        </div>
        
      </div><!-- / row -->
    
    
    <h3>Crawl priority <i>search googlebots</i></h3>
    <p>Most popular pages to Googleâ€™s eyes</p>
    <p id="exportData"></p>
    <svg id="priority" width="960" height="960" font-family="sans-serif" font-size="10" text-anchor="middle"></svg>
    
    <footer class="page-footer">
        <div class="container">
            <div class="row">
                <div class="col l6 s12">
                    <h5 class="white-text">GeekyLog</h5>
                    <p class="grey-text text-lighten-4">Data Mining : Linux commands</br>Data visualization : d3js + materializecss<br>All data is available in TSV</p>
                </div>
                <div class="col l4 offset-l2 s12">
                    <h5 class="white-text">Links</h5>
                    <ul>                      
                        <li><a class="grey-text text-lighten-3" href="https://github.com/VictorVila/GeekyLog">Get the source code on Github</a></li>
                        <li><a class="grey-text text-lighten-3" href="https://twitter.com/tiropcom">Follow me on Twitter : @tiropcom</a></li>
                        <li><a class="grey-text text-lighten-3" href="http://www.tirop.com/">http://www.tirop.com/</a></li>
                    </ul>
              </div>
            </div>
          </div>
          <div class="footer-copyright">
            <div class="container">
                Free Open source 
                <a class="grey-text text-lighten-4 right" href="https://github.com/VictorVila/GeekyLog/blob/master/LICENSE">GNU GPL v3.0</a>
            </div>
        </div>
    </footer>
    
    <script src="js/d3.v4.min.js"></script>
    <script src="js/geeky-log.js"></script>
    <script>
    
    // stats
     
              // while read -r st ;do; a=`echo $st | cut -d" " -f1`;b=`echo $st |cut -d" " -f2;aa[$a]=$b;done;

        
    var stats = d3.json('logs/' + directory + "/global.json", function(error, data) 
    { 
        document.getElementById('hitsTotal').innerHTML = data.hitsTotal;
        document.getElementById('URLsTotal').innerHTML = data.URLsTotal;
        //document.getElementById('URLsActives').innerHTML = data.URLsActives;
        document.getElementById('pagesTotal').innerHTML = data.pagesTotal;
        document.getElementById('pagesTotal2').innerHTML = data.pagesTotal;
        document.getElementById('pagesExplored').innerHTML = data.pagesExplored;
        document.getElementById('pagesUnexplored').innerHTML = data.pagesUnexplored;
        document.getElementById('pagesActives').innerHTML = data.pagesActives;
        document.getElementById('pagesInactives').innerHTML = data.pagesInactives;
        
        document.getElementById('status200').innerHTML = data.status200;
        document.getElementById('status301').innerHTML = data.status301;
        document.getElementById('status302').innerHTML = data.status302;
        document.getElementById('status403').innerHTML = data.status403;
        document.getElementById('status404').innerHTML = data.status404;
        document.getElementById('status410').innerHTML = data.status410;
        document.getElementById('status5xx').innerHTML = data.status5xx;
        
        document.getElementById('assetsCss').innerHTML = data.css;
        document.getElementById('assetsJs').innerHTML = data.js;
        document.getElementById('assetsImages').innerHTML = data.images;
        
        document.getElementById('gBotsHits').innerHTML = data.gBotsHits; 
        //document.getElementById('gBotsErrors').innerHTML = data.gBotsErrors; 
        document.getElementById('gSearchHits').innerHTML = data.gSearchHits; 
        document.getElementById('gSearchHits2').innerHTML = data.gSearchHits; 
        document.getElementById('gSearchMedian').innerHTML = (data.gSearchHits / data.pagesExplored).toFixed(2); 
        document.getElementById('gImgHits').innerHTML = data.gImgHits; 
        document.getElementById('gSearchIPs').innerHTML = data.gSearchIPs; 
        document.getElementById('fakeGbotIPs').innerHTML = data.fakeGbotIPs; 
        
        document.getElementById('botsHits').innerHTML = data.botsHits; 
        document.getElementById('gBotsHits2').innerHTML = data.gBotsHits; 
        document.getElementById('bingHits').innerHTML = data.bingHits; 
        document.getElementById('yandexHits').innerHTML = data.yandexHits; 
        document.getElementById('baiduHits').innerHTML = data.baiduHits; 
    });
    
    // create the data link
    var t = '<a class="rawData waves-effect waves-teal btn"';
    t    += 'href="logs/' + directory + '/urls-gbot.tsv">raw data</a>'; 
    document.getElementById('exportData').innerHTML = t;
    
    
    
    // status
    
   // createPie( "statusSearch", "status-gbot.csv", false );
    
    
    
    // priority

    var svg = d3.select("#priority"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

    var format = d3.format(",d");

    var color = d3.scaleOrdinal(d3.schemeCategory20c);

    var pack = d3.pack()
        .size([width, height])
        .padding(1.5);

    // loading data
    d3.tsv('logs/' + directory + "/urls-gbot-top-50.tsv", function(d) 
    {
      d.value = +d.value;
      if (d.value) return d;
    }, 
    function(error, classes) 
    {
      if (error) throw error;
      var root = d3.hierarchy({children: classes})
          .sum(function(d) { return d.value; })
          .each(function(d) 
          {
            if (id = d.data.id) 
            {
                // drop extensions
                id=id.replace(/.html|.xml|.php|.txt/, '')
                id=id.replace('.css', '_css');
                id=id.replace('.js', '_js');
                // bug with home which is '.'
                if (id === '.') id = '.home';
                
                // modify special folders like language folders : .en.  .fr. 
                if (id.lastIndexOf(".") === (id.length-1))
                {
                    id = id.slice(0, (id.length -1)); 
                }
                
                var id, i = id.lastIndexOf(".");
                d.id = id;
                //d.package = id.slice(0, i);
                // d.package = id.indexOf('.',id.indexOf('.',id.indexOf('.')+1)+1)
                d.package = id.indexOf('.',id.indexOf('.')+1)
                d.class = id.slice(i + 1);
                /*
                console.log("\n----------------")
                console.log("id: " + id)
                console.log("package: " + d.package)
                console.log("class: " + d.class)
                */
            }
          });

      var node = svg.selectAll(".node")
        .data(pack(root).leaves())
        .enter().append("g")
          .attr("class", "node")
          .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

      node.append("circle")
          .attr("id", function(d) { return d.id; })
          .attr("r", function(d) { return d.r; })
          .style("fill", function(d) { return color(d.package); });

      node.append("clipPath")
          .attr("id", function(d) { return "clip-" + d.id; })
        .append("use")
          .attr("xlink:href", function(d) { return "#" + d.id; });

      node.append("text")
          .attr("clip-path", function(d) { return "url(#clip-" + d.id + ")"; })
        .selectAll("tspan")
        .data(function(d) { return d.class.split(/(?=[A-Z][^A-Z])/g); })
        .enter().append("tspan")
          .attr("x", 0)
          .attr("y", function(d, i, nodes) { return 13 + (i - nodes.length / 2 - 0.5) * 10; })
          .text(function(d) { return d; });

      node.append("title")
          .text(function(d) { return d.id + "\nTotal hits : " + format(d.value); });
    });
    
    // loader
    document.getElementById('loader').setAttribute('style','display:none');
    console.log('end')

    </script>
</body>
</html>
